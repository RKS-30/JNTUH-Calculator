<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JNTUH SGPA & CGPA Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #27ae60;
            --danger: #e74c3c;
            --light: #f5f5f5;
            --dark: #333;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light);
            color: var(--dark);
            padding: 15px;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            background: white;
            padding: 24px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }

        h1,
        h2,
        h3 {
            text-align: center;
            color: var(--secondary);
            margin-bottom: 16px;
        }

        h1 {
            font-size: clamp(1.5rem, 3vw, 2rem);
        }

        .tab-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        /* Centered PDF Upload Section */
        #pdf-tab {
            text-align: center;
        }

        #pdf-upload {
            display: inline-block;
            margin-bottom: 15px;
            padding: 8px;
            border: 1px solid var(--border, #ccc);
            border-radius: 5px;
            width: 100%;
            max-width: 300px;
            font-size: 1rem;
        }

        #process-pdf {
            display: inline-block;
            margin-top: 5px;
        }

        /* Button styles */
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
            margin: 5px;
        }

        button:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .status.success {
            background: #e0f6ea;
            color: var(--success);
        }

        .status.error {
            background: #fdecea;
            color: var(--danger);
        }

        .loading {
            text-align: center;
            color: var(--primary);
            font-weight: bold;
            margin: 10px 0;
        }

        /* Results Section */
        .semester {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #ddd;
            position: relative;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: clamp(14px, 2vw, 16px);
        }

        th,
        td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        th {
            background-color: var(--secondary);
            color: white;
        }

        input,
        select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            font-weight: 500;
            margin-top: 8px;
        }

        .result-value {
            color: var(--secondary);
            font-weight: bold;
        }

        .remove-semester {
            position: absolute;
            top: 10px;
            right: 15px;
        }

        .description-blog a {
            text-decoration: none;
            font-weight: 600;
        }

        .description-blog a:hover {
            text-decoration: underline;
        }

        .description-blog ol li {
            margin-bottom: 10px;
        }

        /* Responsive Tweaks */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .tab {
                flex: 1 1 45%;
                text-align: center;
            }

            table,
            th,
            td {
                font-size: 0.9rem;
            }

            button {
                width: 100%;
                margin: 8px 0;
            }

            #pdf-upload {
                width: 100%;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>JNTUH SGPA & CGPA Calculator</h1>

        <!-- Webpage description -->
        <div class="description-blog"
            style="margin-bottom: 25px; padding: 20px; background-color: #f0f8ff; border-left: 5px solid #3498db; border-radius: 8px; font-size: 1.05rem; line-height: 1.6;">
            <h2 style="color: #2c3e50; margin-bottom: 10px;">üìò What This Tool Is About</h2>
            <p>
                If you're a student under <strong>Jawaharlal Nehru Technological University Hyderabad (JNTUH)</strong>,
                you know the pain of calculating SGPA, CGPA, and percentage manually ‚Äî especially if you're carrying
                <strong>backlogs</strong> or have multiple PDFs lying around.
            </p>
            <p>
                This website helps you <strong>automatically calculate</strong> your <span
                    style="color:#27ae60;"><strong>SGPA (Semester Grade Point Average)</strong></span>, <span
                    style="color:#e67e22;"><strong>CGPA (Cumulative GPA)</strong></span>, and overall <span
                    style="color:#e74c3c;"><strong>percentage</strong></span> ‚Äî just by uploading your result PDF. It‚Äôs
                fast, accurate, and handles all cases including <strong>backlogs</strong>, labs, projects, and more.
            </p>

            <h2 style="color: #2c3e50; margin-top: 20px;">üì• How to Get Started</h2>
            <ol style="margin-left: 20px; padding-left: 10px;">
                <li>üîé Visit the official JNTUH results portal: <a
                        href="https://jntuhresults.vercel.app/academicresult#google_vignette" target="_blank"
                        style="color: #3498db;"><strong>jntuhresults.vercel.app</strong></a></li>
                <li>üßæ Enter your Hall Ticket Number to view your result.</li>
                <li>üìÑ At the bottom of your result page, click <strong>"Download PDF"</strong>.</li>
                <li>üìÇ Come back here and <strong>upload the downloaded PDF</strong> using the ‚ÄúChoose File‚Äù button
                    below.</li>
                <li>‚öôÔ∏è Click <strong>‚ÄúProcess PDF‚Äù</strong> ‚Äî and boom üí•! You‚Äôll see your SGPA, CGPA, and percentage
                    semester-wise.</li>
            </ol>

            <h2 style="color: #2c3e50; margin-top: 20px;">‚úçÔ∏è No PDF? No Problem!</h2>
            <p>
                You can also switch to the <strong>Manual Input</strong> tab to add your subjects, credits, and grades
                manually. It‚Äôs flexible for any student who doesn‚Äôt have access to their PDF yet.
            </p>

            <p style="margin-top: 15px;">
                Built for students. Optimized for simplicity. üíô
            </p>
        </div>

        <!-- Webpage Disclaimer -->
        <div
            style="margin-top: 30px; background-color: #fff9e6; border-left: 5px solid #ffcc00; padding: 16px 20px; border-radius: 8px; color: #664d03; font-size: 1rem;">
            <strong>‚ö†Ô∏è Disclaimer:</strong><br>
            This calculator is built to make your academic life easier ‚Äî especially if you‚Äôre juggling backlogs or just
            want quick insights. It works hard to read your JNTUH result PDFs and crunch your SGPA, CGPA, and percentage
            based on the latest available data.
            <br><br>
            However, if you're still clearing some subjects, keep in mind that these results are <strong>best-effort
                estimations</strong>. Once all subjects are passed and officially processed by JNTUH, your final CGPA or
            percentage might vary slightly.
            <br><br>
            So use this tool for clarity and confidence ‚Äî just remember, your official transcript always has the final
            say. üìú‚ú®
        </div><br>


        <div class="tab-container">
            <div class="tab active" data-tab="pdf">PDF Upload</div>
            <div class="tab" data-tab="manual">Manual Input</div>
        </div>

        <!-- PDF Upload Section -->
        <div id="pdf-tab" class="tab-content active">
            <h2>Upload PDF Results</h2>
            <input type="file" id="pdf-upload" accept=".pdf">
            <button id="process-pdf" class="btn-success">Process PDF</button>
            <div id="pdf-status" class="status hidden"></div>
            <div id="pdf-loading" class="loading hidden" style="display: none;"></div>

            <div id="pdf-results-container" class="hidden">
                <h2>Results</h2>
                <div id="semesters-container"></div>
                <div id="final-results"></div>
            </div>
        </div>

        <!-- Manual Input Section -->
        <div id="manual-tab" class="tab-content">
            <h2>Manual Input</h2>

            <div id="manual-semesters-container">
                <!-- Semesters will be added here -->
            </div>

            <div style="text-align: center;">
                <button id="add-semester" class="btn-success">+ Add Semester</button>
                <button id="calculate-manual" class="btn-success">Calculate CGPA</button>
            </div>

            <div id="manual-results-container" class="hidden">
                <h3>Results</h3>
                <div id="manual-final-results"></div>
            </div>
        </div>
    </div>

    <script>
        // Set PDF.js worker path
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';

        document.addEventListener('DOMContentLoaded', function () {
            // Tab Switching
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                });
            });

            // PDF Processing Elements
            const pdfUpload = document.getElementById('pdf-upload');
            const processPdfBtn = document.getElementById('process-pdf');
            const pdfStatus = document.getElementById('pdf-status');
            const pdfLoading = document.getElementById('pdf-loading');


            const pdfResultsContainer = document.getElementById('pdf-results-container');
            const semestersContainer = document.getElementById('semesters-container');
            const finalResults = document.getElementById('final-results');

            // Manual Input Elements
            const manualSemestersContainer = document.getElementById('manual-semesters-container');
            const addSemesterBtn = document.getElementById('add-semester');
            const calculateManualBtn = document.getElementById('calculate-manual');
            const manualResultsContainer = document.getElementById('manual-results-container');
            const manualFinalResults = document.getElementById('manual-final-results');

            // Initialize with one semester
            addManualSemester();

            // Event Listeners
            processPdfBtn.addEventListener('click', processPdf);
            addSemesterBtn.addEventListener('click', addManualSemester);
            calculateManualBtn.addEventListener('click', calculateManualResults);

            async function processPdf() {
                const file = pdfUpload.files[0];
                if (!file) {
                    showStatus('Please select a PDF file first.', 'error');
                    return;
                }

                pdfLoading.classList.remove('hidden');   // Show "Processing PDF..."
                pdfStatus.classList.add('hidden');
                semestersContainer.innerHTML = '';
                finalResults.innerHTML = '';

                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;

                    let allText = '';
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const text = textContent.items.map(item => item.str).join(' ');
                        allText += text + '\n';
                    }

                    const results = parseResults(allText);
                    displayResults(results);
                    showStatus('PDF processed successfully!', 'success');
                    pdfResultsContainer.classList.remove('hidden');

                } catch (error) {
                    console.error("Error processing PDF:", error);
                    showStatus('Error processing PDF. Please check the file format.', 'error');
                } finally {
                    pdfLoading.classList.add('hidden');   // ‚úÖ hide "Processing PDF..."
                }
            }

            function parseResults(text) {
                const results = {
                    semesters: [],
                    studentInfo: {}
                };

                // Extract student info
                const nameMatch = text.match(/(?:NAME|NAME:)\s*([A-Z\s]+)/i);
                const rollNoMatch = text.match(/(?:Roll_No|HTNO:)\s*([A-Z0-9]+)/i);
                results.studentInfo.name = nameMatch ? nameMatch[1].trim() : '';
                results.studentInfo.rollNo = rollNoMatch ? rollNoMatch[1].trim() : '';

                // Split by semesters
                const semesterSections = splitBySemesters(text);

                // Process each semester
                semesterSections.forEach(section => {
                    const semesterData = parseSemester(section.name, section.content);
                    if (semesterData.subjects.length > 0) {
                        results.semesters.push(semesterData);
                    }
                });

                return results;
            }

            function splitBySemesters(text) {
                const semesterSections = [];
                const semesterRegex = /(\d-\d)\s*Results?|(?:Result of|Semester)\s*([IVXLCDM]+)/gi;

                let lastIndex = 0;
                let match;

                // Find all semester headers
                const semesterHeaders = [];
                while ((match = semesterRegex.exec(text)) !== null) {
                    const semesterName = match[1] || match[2];
                    semesterHeaders.push({
                        name: semesterName,
                        index: match.index
                    });
                }

                // Extract content between headers
                for (let i = 0; i < semesterHeaders.length; i++) {
                    const current = semesterHeaders[i];
                    const next = semesterHeaders[i + 1];

                    const start = current.index;
                    const end = next ? next.index : text.length;
                    const content = text.substring(start, end);

                    semesterSections.push({
                        name: current.name,
                        content: content
                    });
                }

                return semesterSections;
            }

            function parseSemester(name, content) {
                const semester = {
                    name: name,
                    subjects: [],
                    sgpa: 0
                };

                // Find SGPA if present
                const sgpaMatch = content.match(/SGPA[:\s]*([\d.]+)/i);
                if (sgpaMatch) {
                    semester.sgpa = parseFloat(sgpaMatch[1]);
                }

                // Match any line with a subject code, name, grade, and credit
                const subjectRegex = /([A-Z0-9]{5,10})\s+([A-Za-z0-9\s\-\&\(\)\/]+?)\s+(?:\d+\s+)?(?:\d+\s+)?(?:\d+\s+)?([OABCDF][\+\-]?|Absent|Ab)\s+(\d\.?\d?)/g;
                let match;

                while ((match = subjectRegex.exec(content)) !== null) {
                    const code = match[1];
                    const name = match[2].trim();
                    const grade = match[3];
                    const credit = parseFloat(match[4]);

                    if (!isNaN(credit) && grade) {
                        semester.subjects.push({ code, name, grade, credits: credit });
                    }
                }

                return semester;
            }

            function displayResults(results) {

                // Display each semester
                let totalCredits = 0;
                let totalGradePoints = 0;

                results.semesters.forEach(semester => {
                    let semesterCredits = 0;
                    let semesterGradePoints = 0;

                    const subjectsHTML = semester.subjects.map(subject => {
                        const gradeValue = convertGradeToValue(subject.grade);
                        const subjectGradePoints = subject.credits * gradeValue;

                        semesterCredits += subject.credits;
                        semesterGradePoints += subjectGradePoints;

                        return `
                            <tr>
                                <td>${subject.code}</td>
                                <td>${subject.name}</td>
                                <td>${subject.credits}</td>
                                <td>${subject.grade} (${gradeValue})</td>
                            </tr>
                        `;
                    }).join('');

                    const calculatedSGPA = semesterCredits > 0 ? (semesterGradePoints / semesterCredits).toFixed(2) : 0;
                    const percentage = (calculatedSGPA * 10).toFixed(2);

                    totalCredits += semesterCredits;
                    totalGradePoints += semesterGradePoints;

                    const semesterHTML = `
                        <div class="semester">
                            <h3>Semester ${semester.name}</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Code</th>
                                        <th>Subject</th>
                                        <th>Credits</th>
                                        <th>Grade</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${subjectsHTML}
                                </tbody>
                            </table>
                            <div class="result-item">
                                <span>Calculated SGPA:</span>
                                <span class="result-value">${calculatedSGPA}</span>
                            </div>
                            <div class="result-item">
                                <span>Percentage:</span>
                                <span class="result-value">${percentage}%</span>
                            </div>
                        </div>
                    `;

                    semestersContainer.innerHTML += semesterHTML;
                });

                // Display final results
                const cgpa = totalCredits > 0 ? (totalGradePoints / totalCredits).toFixed(2) : 0;
                const percentage = (cgpa * 10).toFixed(2);

                finalResults.innerHTML = `
                    <div class="semester">
                        <h3>Final Results</h3>
                        <div class="result-item">
                            <span>Total Credits:</span>
                            <span class="result-value">${totalCredits}</span>
                        </div>
                        <div class="result-item">
                            <span>CGPA:</span>
                            <span class="result-value">${cgpa}</span>
                        </div>
                        <div class="result-item">
                            <span>Percentage (CGPA √ó 10):</span>
                            <span class="result-value">${percentage}%</span>
                        </div>
                    </div>
                `;
            }

            function addManualSemester() {
                const semesterCount = document.querySelectorAll('#manual-semesters-container .semester').length + 1;
                const semesterDiv = document.createElement('div');
                semesterDiv.className = 'semester';
                semesterDiv.innerHTML = `
                    <h3>Semester ${semesterCount}</h3>
                    <button class="remove-semester btn-danger">√ó Remove</button>
                    <table>
                        <thead>
                            <tr>
                                <th>Subject</th>
                                <th>Credits</th>
                                <th>Grade</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" placeholder="Subject name"></td>
                                <td><input type="number" min="0" step="0.5" value="3"></td>
                                <td>
                                    <select>
                                        <option value="10">O (10)</option>
                                        <option value="9">A+ (9)</option>
                                        <option value="8">A (8)</option>
                                        <option value="7">B+ (7)</option>
                                        <option value="6">B (6)</option>
                                        <option value="5">C (5)</option>
                                        <option value="0">F (0)</option>
                                    </select>
                                </td>
                                <td>
                                    <button class="add-subject btn-success">+</button>
                                    <button class="remove-subject btn-danger">-</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                `;

                manualSemestersContainer.appendChild(semesterDiv);

                // Add event listeners
                semesterDiv.querySelector('.remove-semester').addEventListener('click', function () {
                    if (document.querySelectorAll('#manual-semesters-container .semester').length > 1) {
                        semesterDiv.remove();
                        updateSemesterNumbers();
                    } else {
                        alert("You need at least one semester!");
                    }
                });

                semesterDiv.querySelector('.add-subject').addEventListener('click', function () {
                    addSubjectToTable(this.closest('tbody'));
                });

                semesterDiv.querySelector('.remove-subject').addEventListener('click', function () {
                    const row = this.closest('tr');
                    if (row.parentElement.children.length > 1) {
                        row.remove();
                    } else {
                        alert("You need at least one subject!");
                    }
                });
            }

            function addSubjectToTable(tbody) {
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td><input type="text" placeholder="Subject name"></td>
                    <td><input type="number" min="0" step="0.5" value="3"></td>
                    <td>
                        <select>
                            <option value="10">O (10)</option>
                            <option value="9">A+ (9)</option>
                            <option value="8">A (8)</option>
                            <option value="7">B+ (7)</option>
                            <option value="6">B (6)</option>
                            <option value="5">C (5)</option>
                            <option value="0">F (0)</option>
                        </select>
                    </td>
                    <td>
                        <button class="add-subject btn-success">+</button>
                        <button class="remove-subject btn-danger">-</button>
                    </td>
                `;

                tbody.appendChild(newRow);

                newRow.querySelector('.add-subject').addEventListener('click', function () {
                    addSubjectToTable(this.closest('tbody'));
                });

                newRow.querySelector('.remove-subject').addEventListener('click', function () {
                    const row = this.closest('tr');
                    if (row.parentElement.children.length > 1) {
                        row.remove();
                    } else {
                        alert("You need at least one subject!");
                    }
                });
            }

            function updateSemesterNumbers() {
                document.querySelectorAll('#manual-semesters-container .semester').forEach((semester, index) => {
                    semester.querySelector('h3').textContent = `Semester ${index + 1}`;
                });
            }

            function calculateManualResults() {
                let totalCredits = 0;
                let totalGradePoints = 0;
                let semesterResults = [];

                document.querySelectorAll('#manual-semesters-container .semester').forEach((semesterDiv, index) => {
                    let semesterCredits = 0;
                    let semesterGradePoints = 0;

                    semesterDiv.querySelectorAll('tbody tr').forEach(row => {
                        const credits = parseFloat(row.querySelector('td:nth-child(2) input').value) || 0;
                        const grade = parseFloat(row.querySelector('td:nth-child(3) select').value) || 0;

                        semesterCredits += credits;
                        semesterGradePoints += credits * grade;
                    });

                    const sgpa = semesterCredits > 0 ? (semesterGradePoints / semesterCredits).toFixed(2) : 0;
                    const percentage = (sgpa * 10).toFixed(2);

                    semesterResults.push({
                        semester: index + 1,
                        credits: semesterCredits,
                        gradePoints: semesterGradePoints,
                        sgpa: sgpa,
                        percentage: percentage
                    });

                    totalCredits += semesterCredits;
                    totalGradePoints += semesterGradePoints;
                });

                const cgpa = totalCredits > 0 ? (totalGradePoints / totalCredits).toFixed(2) : 0;
                const percentage = (cgpa * 10).toFixed(2);

                let resultsHTML = '<div class="semester"><h3>Results</h3>';

                semesterResults.forEach(result => {
                    resultsHTML += `
                        <div class="result-item">
                            <span>Semester ${result.semester} SGPA:</span>
                            <span class="result-value">${result.sgpa}</span>
                        </div>
                        <div class="result-item">
                            <span>Semester ${result.semester} Percentage:</span>
                            <span class="result-value">${result.percentage}%</span>
                        </div>
                    `;
                });

                resultsHTML += `
                    <div class="result-item">
                        <span>Total Credits:</span>
                        <span class="result-value">${totalCredits}</span>
                    </div>
                    <div class="result-item">
                        <span>CGPA:</span>
                        <span class="result-value">${cgpa}</span>
                    </div>
                    <div class="result-item">
                        <span>Percentage (CGPA √ó 10):</span>
                        <span class="result-value">${percentage}%</span>
                    </div>
                </div>`;

                manualFinalResults.innerHTML = resultsHTML;
                manualResultsContainer.classList.remove('hidden');
            }

            function convertGradeToValue(grade) {
                // Correct JNTUH grade point values
                if (grade === 'B+') return 7;
                if (grade === 'B') return 6;
                if (grade === 'A+') return 9;
                if (grade === 'A') return 8;

                const gradeMap = {
                    'O': 10,
                    'C': 5,
                    'F': 0,
                    'ABS': 0,
                    'Ab': 0
                };
                return gradeMap[grade] || 0;
            }

            function showStatus(message, type) {
                const statusDiv = document.getElementById('pdf-status');
                statusDiv.textContent = message;
                statusDiv.className = `status ${type}`;
                statusDiv.classList.remove('hidden');
            }
        });
    </script>
</body>

</html>